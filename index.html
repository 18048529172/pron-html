<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>视频总览</title>
	<link rel="stylesheet" type="text/css" href="themes/default/easyui.css">
	<link rel="stylesheet" type="text/css" href="themes/icon.css">
	<script type="text/javascript" src="jquery.min.js"></script>
	<script type="text/javascript" src="jquery.easyui.min.js"></script>
	<script type="text/javascript" src="easyui-lang-zh_CN.js"></script>

</head>
<body class="easyui-layout">
<div data-options="region:'east',split:true,collapsed:true,title:'East'" style="width:100px;padding:10px;">east region</div>
<div data-options="region:'center',title:'视频列表'">
	<form id="ff">
		<table>
			<tr>
				<td>关键字</td>
				<td><input class="easyui-textbox" type="text" id="keyword" data-options="required:false"></input></td>
				<td>标题</td>
				<td><input class="easyui-textbox" type="text" id="title" data-options="required:false"></input></td>
				<td>内容</td>
				<td><input class="easyui-textbox" type="text" id="content" data-options="required:false"></input></td>
				<td>作者</td>
				<td><input class="easyui-textbox" type="text" id="author" data-options="required:false"></input></td>
				<td><a href="javascript:void(0)" class="easyui-linkbutton"  id="query">查询</a></td>
			</tr>
		</table>
	</form>
	<table id="dg"></table>
	<a download="" href="" target="blank" id="down"></a>
</div>
<script>

	function downByUrl( remoteDownUrl,title ){
        try{
            var a = document.getElementById("down");
            a.href=remoteDownUrl;
            a.download=title;
            a.click();
        }catch(e){
            $.messager.alert('提示','下载失败','error');
        }
    }

	 function down(id,title) {
		 $.get("http://localhost:8081/pron/down/"+id,function(address){
		     if(address){
                 downByUrl(address,title);
			 }else{
                 $.messager.alert('提示','找不到下载地址','error');
             }
            /* $("#targetd").empty();
             $("#targetd").html("<a target=\"_blank\" class=\"easyui-linkbutton\" href=\""+address+"\" download=\"a\">"+title+"</a>");*/
		 })
     }




    $(function(){
        $('#dg').datagrid({
            url:'http://localhost:8081/pron/list',
            columns:[[
                {field:'id',title:'下载',formatter: function(value,row,index){
                        var title = row.title;

						return "<a  href='javascript:void(0);' onclick=\"down('"+value+"\','"+title+"');\">获取地址</a>"
                	}
                },
                {field:'title',title:'名称'},
                {field:'author',title:'作者'},
                {field:'content',title:'内容'}
            ]],
            pagination:true,
            fitColumns:true,
            singleSelect : true,
            pageSize : 20,
            onDblClickRow : function(index,row){
                //双击事件
				///pron/address/{id}
				var url = "http://localhost:8081/pron/address/"+row.id;
				$.get(url,function(openUrl){
                    window.open(openUrl);
				})

            }
        });
        $("#query").click(function () {
            var parm = {};
            var keyword = $("#keyword").val();
            var author = $("#author").val();
            var title = $("#title").val();
            var content = $("#content").val();
            if(keyword){
                parm.keyword = keyword;
            }
            if(author){
                parm.author = author;
            }
            if(title){
                parm.title = title;
			}
            if(content){
                parm.content = content;
            }
            $('#dg').datagrid('load',parm);
        });
    })

</script>

</body>

</html>